<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPSR Tools</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <!-- Resize handles for frameless window -->
    <div class="resize-handle resize-top"></div>
    <div class="resize-handle resize-right"></div>
    <div class="resize-handle resize-bottom"></div>
    <div class="resize-handle resize-left"></div>
    <div class="resize-handle resize-top-left"></div>
    <div class="resize-handle resize-top-right"></div>
    <div class="resize-handle resize-bottom-left"></div>
    <div class="resize-handle resize-bottom-right"></div>

    <div class="bpsr-tools">
      <header class="controls">
        <img
          src="icon.png"
          alt="Logo"
          style="height: 40px; margin-right: 10px"
        />
        <button
          class="control-button btn-medium"
          id="reset-button"
          title="Clear Meter"
        >
          <i class="fa-solid fa-broom"></i>
        </button>
        <button
          class="control-button btn-medium"
          id="pause-button"
          title="Pause/Resume Tracking"
        >
          <i class="fa-solid fa-pause"></i>
        </button>
        <button
          class="control-button btn-medium"
          id="parse-button"
          title="Parse Mode"
        >
          <i class="fa-solid fa-crosshairs"></i>
        </button>
        <!-- Advanced/Lite button -->
        <button
          class="control-button btn-large"
          id="advanced-lite-btn"
          title="Toggle Advanced/Lite"
        >
          Advanced
        </button>
        <!-- DPS/Healer button only visible in Lite mode -->
        <button
          class="control-button btn-large"
          id="lite-dps-healer-btn"
          style="display: none"
        >
          DPS
        </button>
        <!-- Filter button -->
        <button
          class="control-button"
          id="filter-button"
          title="Filter Options"
        >
          <i class="fa-solid fa-filter"></i>
        </button>
        <div style="flex: 1"></div>
        <!-- Theme toggle button -->
        <button
          class="control-button"
          id="theme-toggle-button"
          title="Toggle Light/Dark Mode"
        >
          <i class="fa-solid fa-moon"></i>
        </button>
        <!-- Always on top toggle (Electron only) -->
        <button
          class="control-button electron-only"
          id="always-on-top-button"
          title="Toggle Always on Top"
          style="display: none"
        >
          <i class="fa-solid fa-thumbtack"></i>
        </button>
        <button class="control-button" id="close-button" title="Close window">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </header>

      <div id="logs-section"></div>

      <!-- Collapsible Panels -->
      <div id="collapsible-panels">
        <!-- Filter Panel -->
        <div id="filter-panel" class="collapsible-panel">
          <div class="panel-content">
            <div class="filter-group">
              <label for="monster-type-filter">Monster Type:</label>
              <div class="filter-multiselect" id="monster-type-filter">
                <button type="button" class="filter-multiselect-button">
                  <span class="filter-multiselect-text">All Selected</span>
                  <i class="fa-solid fa-chevron-down filter-multiselect-arrow"></i>
                </button>
                <div class="filter-multiselect-dropdown" style="display: none">
                  <div class="filter-checkbox-group">
                    <label class="filter-checkbox-item">
                      <input type="checkbox" value="normal" checked />
                      <span>Normal</span>
                    </label>
                    <label class="filter-checkbox-item">
                      <input type="checkbox" value="dummy" checked />
                      <span>Dummy</span>
                    </label>
                    <label class="filter-checkbox-item">
                      <input type="checkbox" value="elite" checked />
                      <span>Elite</span>
                    </label>
                    <label class="filter-checkbox-item">
                      <input type="checkbox" value="boss" checked />
                      <span>Boss</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Parse Panel -->
        <div id="parse-panel" class="collapsible-panel" style="display: none;">
          <div class="panel-content">
            <label style="display: block; margin-bottom: 12px; font-size: 0.85rem;">
              Parse Duration: <span id="parse-duration-display">3</span> min
            </label>
            <input
              type="range"
              id="parse-duration-slider"
              min="1"
              max="5"
              value="3"
              step="1"
            />
            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 12px;">
              <span style="font-size: 0.85rem; color: var(--text-primary);">Export to PNG</span>
              <label class="toggle-switch">
                <input type="checkbox" id="parse-export-checkbox" />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div style="display: flex; gap: 6px; margin-top: 12px;">
              <button id="parse-start-btn" class="modal-btn confirm" style="flex: 1;">Start</button>
              <button id="parse-cancel-btn" class="modal-btn cancel" style="flex: 1;">Cancel</button>
            </div>

            <!-- Verification Section -->
            <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-default);">
              <label style="display: block; margin-bottom: 8px; font-size: 0.85rem; font-weight: 600;">
                Verify PNG Parse
              </label>
              <div id="verify-drop-zone" style="border: 2px dashed var(--border-default); border-radius: 6px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; background: var(--surface-base);">
                <i class="fa-solid fa-file-image" style="font-size: 2rem; color: var(--text-secondary); margin-bottom: 8px;"></i>
                <p style="margin: 0; font-size: 0.85rem; color: var(--text-secondary);">Drop PNG here or click to select</p>
              </div>
              <input type="file" id="verify-file-input" accept="image/png" style="display: none;" />
              <div id="verify-result" style="margin-top: 12px; display: none;"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="loading-indicator" class="gui-loading-overlay">
        <div class="gui-loading-content">
          <div class="gui-spinner"></div>
          <p class="gui-loading-text">Waiting for combat data...</p>
          <p class="gui-loading-hint">Start a fight to see DPS metrics</p>
        </div>
      </div>
      <main id="player-bars-container"></main>
    </div>

    <script src="js/guiClient.js"></script>
  </body>
</html>
